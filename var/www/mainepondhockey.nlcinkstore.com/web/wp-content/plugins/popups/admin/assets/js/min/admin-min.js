var spu={rules:null};SPU_ADMIN=function($){function e(e){"percentage"==e||"visible"==e?$("tr.auto_hide").fadeIn("fast"):$("tr.auto_hide").fadeOut("fast"),"manual"==e||"trigger-click"==e||"visible"==e||"exit-intent"==e?$(".spu-trigger-number").fadeOut("fast"):$(".spu-trigger-number").fadeIn("fast")}function t(e,t){return e.val()?parseInt(e.val()):void 0!==t?t+"px":0}function r(e,t){return e.val().length>0?e.wpColorPicker("color"):void 0!==t?t:""}function n(){var e=$("#content_ifr").contents().find("html");e.trigger("spu_tinymce_init"),e.css({background:"#9C9B9B;"}),"undefined"!=typeof spup_js&&""!=$("#spu_optin").val()||(e.find(".spu-fields-container").remove(),e.find("#tinymce").css({padding:"25px","background-color":r($("#spu-background-color")),"border-color":r($("#spu-border-color")),"border-width":t($("#spu-border-width")),"border-style":"solid",width:$("#spu-width").val(),color:r($("#spu-color")),height:"auto","min-width":"200px","max-width":"100%",margin:"8px auto 0;"}))}return $(document).ready(function(){spu.rules.init();var t=$("#spu-appearance input.spu-color-field"),r=$("#spu_optin");!t.length||r.length&&""!=r.val()||t.wpColorPicker({change:n,clear:n}),$("#spu-appearance :input").not(".spu-color-field").change(n),e($("#spu_trigger").val()),$("#spu_trigger").change(function(){e($(this).val())})}),spu.rules={$el:null,init:function(){var e=this;e.$el=$("#spu-rules"),e.$el.on("click",".rules-add-rule",function(){return e.add_rule($(this).closest("tr")),!1}),e.$el.on("click",".rules-remove-rule",function(){return e.remove_rule($(this).closest("tr")),!1}),e.$el.on("click",".rules-add-group",function(){return e.add_group(),!1}),e.$el.on("change",".param select",function(){var e=$(this).closest("tr"),t=e.attr("data-id"),r=e.closest(".rules-group"),n=r.attr("data-id"),s=e.find("td.value"),a={action:"spu/field_group/render_rules",nonce:spu_js.nonce,rule_id:t,group_id:n,value:"",param:$(this).val()},i=$('<div class="spu-loading"><img src="'+spu_js.admin_url+'/images/wpspin_light.gif"/> </div>');s.html(i),$.ajax({url:ajaxurl,data:a,type:"post",dataType:"html",success:function(e){s.html(e)}});var o=e.find("td.operator"),a={action:"spu/field_group/render_operator",nonce:spu_js.nonce,rule_id:t,group_id:n,value:"",param:$(this).val()};o.html(i),$.ajax({url:ajaxurl,data:a,type:"post",dataType:"html",success:function(e){o.html(e)}})})},add_rule:function(e){var t=e.clone(),r=t.attr("data-id"),n="rule_"+(parseInt(r.replace("rule_",""),10)+1);return t.find("[name]").each(function(){$(this).attr("name",$(this).attr("name").replace(r,n)),$(this).attr("id",$(this).attr("id").replace(r,n))}),t.attr("data-id",n),e.after(t),!1},remove_rule:function(e){var t=e.siblings("tr").length;0==t?this.remove_group(e.closest(".rules-group")):e.remove()},add_group:function(){var e=this.$el.find(".rules-group:last"),t=e.clone(),r=t.attr("data-id"),n="group_"+(parseInt(r.replace("group_",""),10)+1);t.find("[name]").each(function(){$(this).attr("name",$(this).attr("name").replace(r,n)),$(this).attr("id",$(this).attr("id").replace(r,n))}),t.attr("data-id",n),t.find("h4").html(spu_js.l10n.or).addClass("rules-or"),t.find("tr:not(:first)").remove(),e.after(t)},remove_group:function(e){e.remove()}},{onTinyMceInit:function(){n()}}}(jQuery),function(e,$){var t,r=function(){$("#spu-custom-css").val(t.getSession().getValue())},n=function(){$("#custom_css").length&&(t=ace.edit("custom_css"),e.safecss_editor=t,t.getSession().setUseWrapMode(!0),t.setShowPrintMargin(!1),t.getSession().setValue($("#spu-custom-css").val()),t.getSession().setMode("ace/mode/css"),jQuery.fn.spin&&$("#custom_css_container").spin(!1),$("#post").submit(r))};return $.browser.msie&&parseInt($.browser.version,10)<=7?($("#custom_css_container").hide(),$("#spu-custom-css").show(),!1):($(e).load(n),void(e.aceSyncCSS=r))}(this,jQuery);